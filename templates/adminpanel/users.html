{% extends "adminpanel/base_admin.html" %}
{% block title %}Users - Admin - TLE AI{% endblock %}

{% block admin_content %}
<div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold text-gray-800">Users <span class="text-sm font-normal text-gray-400">({{ total }})</span></h1>
    <a href="{% url 'adminpanel:user_add' %}" class="btn-primary px-4 py-2 rounded-lg text-sm">Add User</a>
</div>

<!-- Search & Filters -->
<form method="GET" class="flex gap-3 mb-4 flex-wrap">
    <input type="text" name="q" value="{{ search }}" placeholder="Search by email or name..." class="form-input flex-1 min-w-[200px]">
    <select name="role" class="form-input" style="max-width:140px;">
        <option value="">All Roles</option>
        <option value="staff" {% if role_filter == "staff" %}selected{% endif %}>Staff</option>
        <option value="user" {% if role_filter == "user" %}selected{% endif %}>User</option>
    </select>
    <button type="submit" class="btn-primary px-4 py-2 rounded-lg text-sm">Search</button>
    {% if search or role_filter %}<a href="{% url 'adminpanel:users' %}" class="px-4 py-2 text-sm text-gray-500 hover:text-gray-700">Clear</a>{% endif %}
</form>

<div class="card">
    <div class="table-wrapper">
    <table class="data-table">
        <thead>
            <tr>
                <th>Email</th>
                <th>Name</th>
                <th>Role</th>
                <th>Active</th>
                <th>Joined</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td class="text-gray-700">{{ u.email }}</td>
                <td class="text-gray-600">{{ u.first_name }} {{ u.last_name }}</td>
                <td>{% if u.is_staff %}<span class="text-xs px-2 py-1 rounded-full badge-status-warning">Staff</span>{% else %}<span class="text-xs px-2 py-1 rounded-full badge-status-default">User</span>{% endif %}</td>
                <td>{% if u.is_active %}<span class="text-green-600 text-xs">Yes</span>{% else %}<span class="text-red-500 text-xs">No</span>{% endif %}</td>
                <td class="text-gray-500 text-sm">{{ u.date_joined|date:"M j, Y" }}</td>
                <td>
                    <div class="flex items-center gap-2">
                        <a href="{% url 'adminpanel:user_edit' pk=u.pk %}" class="btn-outline-sm btn-outline-primary">Edit</a>
                        {% if not u.is_staff %}
                        <form method="POST" action="{% url 'adminpanel:masquerade_start' user_id=u.pk %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="btn-outline-sm btn-outline-primary">Masquerade</button>
                        </form>
                        {% endif %}
                        {% if u.pk != request.user.pk %}
                        <form method="POST" action="{% url 'adminpanel:user_delete' pk=u.pk %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="btn-outline-sm btn-outline-danger" onclick="return confirm('Delete user {{ u.email }}?')">Delete</button>
                        </form>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="px-4 py-8 text-center text-gray-400">No users found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>

{% include "adminpanel/partials/pagination.html" with page_obj=users %}
{% endblock %}
